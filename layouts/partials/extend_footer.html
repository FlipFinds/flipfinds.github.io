<script>
  (function () {
    var COUNT_API_BASE = "https://countapi.mileshilliard.com/api/v1";
    var KEY_PREFIX = "flipfinds_store_clicks";

    function isoDay() {
      return new Date().toISOString().slice(0, 10);
    }

    function classifyStore(href) {
      if (!href) return null;
      try {
        var u = new URL(href, window.location.origin);
        var host = (u.hostname || "").toLowerCase();
        var path = (u.pathname || "").toLowerCase();
        if (host.indexOf("play.google.com") !== -1 && u.search.indexOf("id=com.flipfinds.app") !== -1) return "play";
        if (host.indexOf("apps.apple.com") !== -1 && path.indexOf("/flipfinds-resale-tracker/") !== -1) return "appstore";
      } catch (e) {
        return null;
      }
      return null;
    }

    function fireAndForget(url) {
      try {
        fetch(url, { method: "GET", mode: "no-cors", keepalive: true, cache: "no-store" }).catch(function () {});
      } catch (e) {}
      var img = new Image();
      img.src = url + (url.indexOf("?") === -1 ? "?" : "&") + "r=" + Date.now();
    }

    document.addEventListener("click", function (evt) {
      var anchor = evt.target && evt.target.closest ? evt.target.closest("a[href]") : null;
      if (!anchor) return;
      var store = classifyStore(anchor.getAttribute("href"));
      if (!store) return;

      var day = isoDay();
      fireAndForget(COUNT_API_BASE + "/hit/" + KEY_PREFIX + "_total_" + day);
      fireAndForget(COUNT_API_BASE + "/hit/" + KEY_PREFIX + "_" + store + "_" + day);
    });
  })();
</script>
<script>
  (function () {
    function initHeroCarousel(root) {
      var slides = Array.prototype.slice.call(root.querySelectorAll("[data-ff-hero-slide]"));
      var dots = Array.prototype.slice.call(root.querySelectorAll("[data-ff-hero-dot]"));
      var titleEl = root.querySelector("[data-ff-hero-title]");
      var captionEl = root.querySelector("[data-ff-hero-caption]");
      var prevBtn = root.querySelector("[data-ff-hero-prev]");
      var nextBtn = root.querySelector("[data-ff-hero-next]");
      if (!slides.length) return;

      var index = slides.findIndex(function (s) { return s.classList.contains("is-active"); });
      if (index < 0) index = 0;

      function render() {
        slides.forEach(function (slide, i) {
          var active = i === index;
          slide.classList.toggle("is-active", active);
        });
        dots.forEach(function (dot, i) {
          var active = i === index;
          dot.classList.toggle("is-active", active);
          dot.setAttribute("aria-selected", active ? "true" : "false");
        });
        if (titleEl) titleEl.textContent = slides[index].getAttribute("data-title") || "";
        if (captionEl) captionEl.textContent = slides[index].getAttribute("data-caption") || "";
      }

      if (prevBtn) {
        prevBtn.addEventListener("click", function () {
          index = (index - 1 + slides.length) % slides.length;
          render();
        });
      }
      if (nextBtn) {
        nextBtn.addEventListener("click", function () {
          index = (index + 1) % slides.length;
          render();
        });
      }
      dots.forEach(function (dot) {
        dot.addEventListener("click", function () {
          var v = Number(dot.getAttribute("data-ff-hero-dot"));
          if (!Number.isNaN(v) && v >= 0 && v < slides.length) {
            index = v;
            render();
          }
        });
      });

      render();
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll("[data-ff-hero-carousel]").forEach(function (carousel) {
        var root = carousel.closest(".ff-hero-proof");
        if (root) initHeroCarousel(root);
      });
    });
  })();
</script>

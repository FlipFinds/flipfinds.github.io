<script>
  (function () {
    var COUNT_API_BASE = "https://countapi.mileshilliard.com/api/v1";
    var KEY_PREFIX = "flipfinds_store_clicks";

    function isoDay() {
      return new Date().toISOString().slice(0, 10);
    }

    function classifyStore(href) {
      if (!href) return null;
      try {
        var u = new URL(href, window.location.origin);
        var host = (u.hostname || "").toLowerCase();
        var path = (u.pathname || "").toLowerCase();
        if (host.indexOf("play.google.com") !== -1 && u.search.indexOf("id=com.flipfinds.app") !== -1) return "play";
        if (host.indexOf("apps.apple.com") !== -1 && path.indexOf("/flipfinds-resale-tracker/") !== -1) return "appstore";
      } catch (e) {
        return null;
      }
      return null;
    }

    function fireAndForget(url) {
      try {
        fetch(url, { method: "GET", mode: "no-cors", keepalive: true, cache: "no-store" }).catch(function () {});
      } catch (e) {}
      var img = new Image();
      img.src = url + (url.indexOf("?") === -1 ? "?" : "&") + "r=" + Date.now();
    }

    document.addEventListener("click", function (evt) {
      var anchor = evt.target && evt.target.closest ? evt.target.closest("a[href]") : null;
      if (!anchor) return;
      var store = classifyStore(anchor.getAttribute("href"));
      if (!store) return;

      var day = isoDay();
      fireAndForget(COUNT_API_BASE + "/hit/" + KEY_PREFIX + "_total_" + day);
      fireAndForget(COUNT_API_BASE + "/hit/" + KEY_PREFIX + "_" + store + "_" + day);
    });
  })();
</script>
